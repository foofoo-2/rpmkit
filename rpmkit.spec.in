%{!?python_sitelib: %global python_sitelib %(%{__python} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")}

# disable debuginfo
%define debug_package %{nil}


Name:           rpmkit
Version:        @VERSION@
Release:        1%{?dist}
Summary:        Misc rpm and yum related utilities
Group:          Development/Tools
License:        GPLv3+
URL:            https://github.com/ssato/rpmkit
Source0:        https://github.com/ssato/rpmkit/tarball/master/%{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildArch:      noarch
BuildRequires:  python
Requires:       rpm-python
Requires:       sqlite
Requires:       python-BeautifulSoup


%description
RpmKit (Rpm toolkit) contains miscellaneous rpm and yum related utilities.


%package        extras
Summary:        Extra and experimental modules and tools of %{name}
Requires:       python-matplotlib
#Requires:       cx_Oracle


%description    extras
This package provides experimental modules and tools of %{name}.


%prep
%setup -q


%build
%{__python} setup.py build


%install
rm -rf $RPM_BUILD_ROOT
%{__python} setup.py install -O1 --skip-build --root $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT%{_localstatedir}/cache/swapi

# Remove egg files:
rm -f $RPM_BUILD_ROOT%{python_sitelib}/rpmkit-*.egg-info


%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
%doc README
%{_bindir}/buildsrpm
%{_bindir}/identrpm
%{_bindir}/list-requires-by-package-name.sh
%{_bindir}/list-srpmnames-by-file.sh
%{_bindir}/rpm2json
%{_bindir}/rpms2csv
%{_bindir}/rpms2sqldb
%{_bindir}/swapi
%{python_sitelib}/rpmkit/*.py*
%{python_sitelib}/rpmkit/imported/*.py*
%{python_sitelib}/rpmkit/tests/*.py*
%{_localstatedir}/cache/swapi


%files          extras
%doc README examples
%{_bindir}/rk-*
%{python_sitelib}/rpmkit/extras/*.py*
%{python_sitelib}/rpmkit/rhncachedb/*.py*


%changelog
* Thu Oct 18 2012 Satoru SATOH <ssato@redhat.com> - 0.2.10.6-1
- [swapi] Fixes around shorten_dict_keynames
- Split into two RPMs

* Tue Aug 21 2012 Satoru SATOH <ssato@redhat.com> - 0.2.10.5-1
- Enhancement release including some experimental new modules and commands
- [repodata] new command/module to generate 'resolved' metadata from installation DVDs
- [minifyrpmlist] new command/module to minify given rpms list

* Tue Jun 26 2012 Satoru SATOH <ssato@redhat.com> - 0.2.10.4-1
- Enhancement release
- [swapi] new command 'swapi.errata.getAll' to get all errata and CVEs from access.redhat.com

* Mon Jun 25 2012 Satoru SATOH <ssato@redhat.com> - 0.2.10.3-1
- Bug fix and enhancement release
- [swapi] new command 'swapi.cve.getAll' to get all CVE data from access.redhat.com
- Handle cases if package don't have "arch" key but have "arch_label" key

* Mon Jun  4 2012 Satoru SATOH <ssato@redhat.com> - 0.2.10.1-1
- Bug fix release
- Fixes and enhancements around rpmkit.shell.do_task by Masatake YAMATO <yamato@redhat.com>

* Sun May 28 2012 Satoru SATOH <ssato@redhat.com> - 0.2.10-1
- New upstream
- Exported myrepo to another package to reduce extra dependencies

* Sun May 20 2012 Satoru SATOH <ssato@redhat.com> - 0.2.9-1
- New upstream
- some updates and fixes in rpmkit.rhncachedb
- fixed some bugs in newly introduced utility routines in rpmkit.rpmutils

* Fri May 18 2012 Satoru SATOH <ssato@redhat.com> - 0.2.8-1
- New upstream
- new module and command, rhncachedb to create cache database of RHN
- added some useful utility routines in rpmkit.rpmutils

* Sat Mar  3 2012 Satoru SATOH <ssato@redhat.com> - 0.2.6.20120303-1
- Switched to multiprocessing module to avoid deadlock in threads

* Thu Feb 29 2012 Satoru SATOH <ssato@redhat.com> - 0.2.6-2
- Fixed a myrepo bug that default template search path list is not set
- Moved some common parts from rpmkit.myrepo.* to rpmkit.{globals,utils}

* Wed Feb 29 2012 Satoru SATOH <ssato@redhat.com> - 0.2.6-1
- New upstream
- Fixed a bug that remote command is not used

* Wed Feb 29 2012 Satoru SATOH <ssato@redhat.com> - 0.2.5-1
- New upstream
- Modularized myrepo and added some testing code for it
- Switched template engine from Cheetah to Tenjin (built-in)

* Thu Nov 17 2011 Satoru SATOH <ssato@redhat.com> - 0.2.4-1
- New upstream
- swapi: started to adding experimental virtual rpcs (swapi.cve.getCvss)
- started to adding test cases separately
- started to checking codes with pep8 command

* Wed Nov  9 2011 Satoru SATOH <ssato@redhat.com> - 0.2.3.20111109-1
- New snapshot release
- swapi: changed scheme to construct caching dir path for each objects to avoid
  too many subdirs made in caching top dir

* Wed Nov  9 2011 Satoru SATOH <ssato@redhat.com> - 0.2.3-1
- New upstream
- swapi: various fixes and enhancements including no online access is needed if
  cache is enough, system cache, read-only cache, pep8 error fixes, etc.

* Thu Sep 15 2011 Satoru SATOH <ssato@redhat.com> - 0.2.2-1
- New upstream
- src/swapi: fixed a grave bug wrongly calls rpmkit.swapi.main()
- swapi: fixed internal API breakage in main()
- identrpm: added --debug option

* Sun Sep 11 2011 Satoru SATOH <ssato@redhat.com> - 0.2.1-1
- Bump version
- identrpm: fixed some bugs in parse_package_label()

* Sat Sep 10 2011 Satoru SATOH <ssato@redhat.com> - 0.2.0.20110910.1-1
- identrpm: added new command to get metadata for given package labels
- fixed some rpmlint errors
- cleaned up some modules not used any more
- swapi: added custom JSON encoder to format date strings in XML-RPC query results
- swapi: make it allow setting cache expiration dates per API

* Wed Aug 24 2011 Satoru SATOH <ssato@redhat.com> - 0.2.0.20110824.1-1
- make %{_sysconfdir}/myrepo.d owned by this package: suggested by yamato@redhat.com

* Thu Aug  4 2011 Satoru SATOH <ssato@redhat.com> - 0.2.0.20110804.1-1
- myrepo: followed updates in packagemaker
- myrepo: added unit / system test driver
- all python code: moved into python_sitelib/rpmkit/ and arranged wrappers for each
- bump up to 0.2.0

* Mon Aug  1 2011 Satoru SATOH <ssato@redhat.com> - 0.1.20110801.1-1
- Initial (static) packaging
